(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver(e=>{for(const i of e)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function s(e){const i={};return e.integrity&&(i.integrity=e.integrity),e.referrerPolicy&&(i.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?i.credentials="include":e.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(e){if(e.ep)return;e.ep=!0;const i=s(e);fetch(e.href,i)}})();class L{constructor(t,s,r,e){this.x=t,this.y=s,this.vx=r,this.vy=e}move(){this.x+=this.vx,this.y+=this.vy}bounce(t,s){(this.x<=0||this.x>=t)&&(this.vx*=-1),(this.y<=0||this.y>=s)&&(this.vy*=-1)}}const a=class a{constructor(t,s,r=0){this.structure=t,this.colour=s,this.energy=r,this.reacting=0}static randomType(){const t=Object.keys(a.palette),s=t[Math.floor(Math.random()*t.length)];return new a(s,a.palette[s],10)}isTemplate(){return this.structure.length>1}getMonomers(){return this.structure.split("")}react(t){const s=a.reactions[this.structure]?.[t.structure];if(s){const{result:r,deltaE:e}=s,i=this.energy+t.energy;if(e>0&&i<e)return null;const n=i+e,c=new a(r,a.palette[r],n);return c.reacting=5,c}return null}static tryAutocatalysis(t,s,r){const e=[t.structure,s.structure,r.structure];for(const i of a.autocatalyticRules)if(i.reactants.every(n=>e.includes(n))&&e.includes(i.catalyst)){const n=[t,s,r].find(h=>h.structure===i.catalyst);if(n.energy<i.energyCost||Math.random()>i.probability)continue;n.energy-=i.energyCost;const c=new a(i.product,a.palette[i.product],10);return c.reacting=5,c}return null}static tryReplicate(t,s,r,e,i=.1){if(!t.isTemplate())return null;const n=t.getMonomers(),c=[s.structure,r.structure];if(!n.every(x=>c.includes(x))||t.energy<e||Math.random()>i)return null;t.energy-=e;const h=new a(t.structure,t.colour,10);return h.reacting=5,h}};a.autocatalyticRules=[{product:"AB",reactants:["A","B"],catalyst:"BC",energyCost:10,probability:.15},{product:"BC",reactants:["B","C"],catalyst:"AB",energyCost:10,probability:.15},{product:"CD",reactants:["C","D"],catalyst:"DE",energyCost:12,probability:.13},{product:"DE",reactants:["D","E"],catalyst:"CD",energyCost:12,probability:.13},{product:"ABC",reactants:["AB","C"],catalyst:"BCD",energyCost:15,probability:.1},{product:"BCD",reactants:["BC","D"],catalyst:"ABC",energyCost:15,probability:.1},{product:"CDE",reactants:["CD","E"],catalyst:"BCD",energyCost:15,probability:.1}],a.palette={A:"#e63946",B:"#457b9d",C:"#2a9d8f",D:"#8d99ae",E:"#f72585",AB:"#f4a261",AC:"#f7b267",AD:"#f4845f",BC:"#e9c46a",BD:"#b5ead7",BE:"#9d4edd",CD:"#b5179e",CE:"#43bccd",DE:"#7209b7",ABC:"#a3c9a8",BCD:"#f6bd60",CDE:"#43aa8b"},a.reactions={A:{B:{result:"AB",deltaE:-5},C:{result:"AC",deltaE:-4},D:{result:"AD",deltaE:-3}},B:{C:{result:"BC",deltaE:8},D:{result:"BD",deltaE:-2},E:{result:"BE",deltaE:-2}},C:{D:{result:"CD",deltaE:6},E:{result:"CE",deltaE:-1}},AB:{C:{result:"ABC",deltaE:10}},BC:{D:{result:"BCD",deltaE:12}},CD:{E:{result:"CDE",deltaE:14}}};let w=a;class F{constructor(t,s,r){this.particles=[],this.molecules=[],this.reactionRings=[],this.ringPool=[],this.grid=new Map,this.cellSize=50,this.ctx=t,this.width=s,this.height=r}addParticle(t,s){this.particles.push(t),this.molecules.push(s)}getCellKey(t,s){const r=Math.floor(t/this.cellSize),e=Math.floor(s/this.cellSize);return`${r},${e}`}update(){this.grid.clear(),this.particles.forEach((s,r)=>{s.move(),s.bounce(this.width,this.height);const e=this.getCellKey(s.x,s.y);this.grid.has(e)||this.grid.set(e,[]),this.grid.get(e).push(r)});const t=576;this.grid.forEach(s=>{for(let r=0;r<s.length;r++)for(let e=0;e<s.length;e++)for(let i=0;i<s.length;i++)if(r!==e&&r!==i&&e<i){const n=s[r],c=s[e],h=s[i],x=this.molecules[n],C=this.molecules[c],o=this.molecules[h],u=this.particles[n],d=this.particles[c],l=this.particles[h],f=(u.x-d.x)**2+(u.y-d.y)**2,B=(u.x-l.x)**2+(u.y-l.y)**2,b=(d.x-l.x)**2+(d.y-l.y)**2;if(f<t&&B<t&&b<t){const P=w.tryAutocatalysis(x,C,o);if(P){const S=(u.x+d.x+l.x)/3,I=(u.y+d.y+l.y)/3,T=new L(S,I,Math.random()*2-1,Math.random()*2-1);this.particles.push(T),this.molecules.push(P);let y=this.ringPool.find($=>!$.active);y||(y={x:0,y:0,radius:12,maxRadius:30,alpha:.6,active:!0},this.ringPool.push(y)),y.x=S,y.y=I,y.radius=12,y.alpha=.6,y.active=!0,this.reactionRings.push(y)}}}for(let r=0;r<s.length;r++)for(let e=r+1;e<s.length;e++){const i=s[r],n=s[e],c=this.particles[i].x-this.particles[n].x,h=this.particles[i].y-this.particles[n].y;if(c*c+h*h<t){const C=this.molecules[i].react(this.molecules[n]);if(C){this.molecules[i]=C;let o=this.ringPool.find(u=>!u.active);o||(o={x:0,y:0,radius:12,maxRadius:30,alpha:.6,active:!0},this.ringPool.push(o)),o.x=this.particles[i].x,o.y=this.particles[i].y,o.radius=12,o.alpha=.6,o.active=!0,this.reactionRings.push(o),this.particles.splice(n,1),this.molecules.splice(n,1),s.splice(e,1),e--}else{const o=this.molecules[i],u=this.molecules[n],d=Math.min(o.energy,Math.random()*2);o.energy-=d,u.energy+=d;const l=this.particles[i],f=this.particles[n],B=l.vx,b=l.vy;l.vx=f.vx,l.vy=f.vy,f.vx=B,f.vy=b}}}})}draw(){this.ctx.clearRect(0,0,this.width,this.height),this.reactionRings.forEach((t,s)=>{t.active&&(this.ctx.beginPath(),this.ctx.arc(t.x,t.y,t.radius,0,2*Math.PI),this.ctx.strokeStyle=`rgba(255, 255, 0, ${t.alpha})`,this.ctx.lineWidth=2,this.ctx.stroke(),t.radius+=1.5,t.alpha-=.03,t.alpha<=0&&(t.active=!1))}),this.ctx.lineWidth=2,this.ctx.font="10px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.particles.forEach((t,s)=>{const r=this.molecules[s];r.reacting&&r.reacting>0?(this.ctx.fillStyle="white",r.reacting--):this.ctx.fillStyle=r.colour,this.ctx.beginPath(),this.ctx.arc(t.x,t.y,12,0,2*Math.PI),this.ctx.fill(),this.ctx.fillStyle="black",this.ctx.fillText(r.structure,t.x,t.y)})}}const p=document.getElementById("canvas"),W=p.getContext("2d");function z(){p.width=window.innerWidth,p.height=window.innerHeight}window.addEventListener("resize",z);z();const g=new F(W,p.width,p.height);function D(m){g.particles=[],g.molecules=[];for(let t=0;t<m;t++){const s=Math.random()*p.width,r=Math.random()*p.height,e=(Math.random()-.5)*2,i=(Math.random()-.5)*2,n=new L(s,r,e,i),c=w.randomType();g.addParticle(n,c)}}const A=document.getElementById("count");D(parseInt(A.value));let M;function O(){M=requestAnimationFrame(O),g.update(),g.draw()}const v=document.getElementById("startPause");let E=!1;v.addEventListener("click",()=>{E?(cancelAnimationFrame(M),v.textContent="Start"):(D(parseInt(A.value)),O(),v.textContent="Pause"),E=!E});const j=document.getElementById("reset");j.addEventListener("click",()=>{cancelAnimationFrame(M),E=!1,v.textContent="Start",D(parseInt(A.value)),g.draw()});const R=document.getElementById("canvas");function q(){R.width=window.innerWidth,R.height=window.innerHeight}window.addEventListener("resize",q);q();
